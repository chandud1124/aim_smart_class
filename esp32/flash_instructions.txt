#!/bin/bash
# ESP32 Setup Script for Smart Classroom

echo "üöÄ ESP32 Smart Classroom Setup"
echo "================================"

# Current configuration
echo "üìç Current Backend Configuration:"
echo "   Backend IP: 172.16.3.171"
echo "   Backend Port: 3001"
echo "   WebSocket Path: /esp32-ws"
echo "   WiFi SSID: 'I am Not A Witch I am Your Wifi'"
echo ""

# Device MAC addresses that should be registered
echo "üì± Known Device MAC Addresses:"
echo "   Device 1: F0:24:F9:0C:5F:8C (Currently Online)"
echo "   Device 2: 80:F3:DA:64:C6:28 (Currently Online)"
echo "   Device 3: AA:BB:CC:DD:EE:FF (Target device at 172.16.3.181)"
echo ""

echo "‚ö° Pre-Flash Checklist:"
echo "   ‚úÖ Arduino IDE installed"
echo "   ‚úÖ ESP32 board package installed"
echo "   ‚úÖ Required libraries installed (see libraries.txt)"
echo "   ‚úÖ ESP32 connected via USB"
echo "   ‚úÖ Correct board selected (ESP32 Dev Module)"
echo "   ‚úÖ Upload speed set to 921600"
echo ""

echo "üîß Hardware Pin Configuration:"
echo "   Relay Pins: GPIO 4, 16, 17, 5, 19, 18, 21, 22"
echo "   Manual Switch Pins: GPIO 25, 27, 32, 33, 12, 14, 13, 15"
echo "   Status LED: GPIO 2"
echo "   All relays are ACTIVE LOW (ON = LOW signal)"
echo ""

echo "üìã What the ESP32 code will do:"
echo "   1. Connect to WiFi: 'I am Not A Witch I am Your Wifi'"
echo "   2. Establish WebSocket to: ws://172.16.3.171:3001/esp32-ws"
echo "   3. Send authentication with device secret"
echo "   4. Register 8 switches (Fan1, Fan2, Light1, Light2, Projector, NComputing, AC, Printer)"
echo "   5. Send heartbeat every 30 seconds"
echo "   6. Support manual switch override"
echo "   7. Support PIR motion detection (if enabled)"
echo ""

echo "üéØ Expected Results After Upload:"
echo "   ‚Ä¢ Device will appear as 'Online' in web dashboard"
echo "   ‚Ä¢ IP 172.16.3.181 will show as connected"
echo "   ‚Ä¢ MAC address will be registered in database"
echo "   ‚Ä¢ Switch controls will work from web interface"
echo "   ‚Ä¢ Manual switches will work locally"
echo ""

echo "üêõ Troubleshooting Common Issues:"
echo "   ‚Ä¢ WiFi connection failed: Check SSID/password"
echo "   ‚Ä¢ WebSocket failed: Verify backend is running on 172.16.3.171:3001"
echo "   ‚Ä¢ Device not appearing: Check MAC address registration"
echo "   ‚Ä¢ Relays not working: Verify 5V power supply and wiring"
echo ""

echo "üìä Monitor Progress:"
echo "   1. Open Serial Monitor (115200 baud)"
echo "   2. Watch for 'WiFi connected' message"
echo "   3. Look for 'WS connected' message"
echo "   4. Verify 'identified' confirmation"
echo "   5. Check backend logs for device registration"
echo ""

echo "‚ú® Ready to upload improved_esp32.cpp to your ESP32!"
echo "   Press Upload in Arduino IDE to flash the firmware."
